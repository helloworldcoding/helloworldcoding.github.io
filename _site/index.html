<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>If not now,when ? &#8211; Hello world, Let's Coding!</title>
<meta name="description" content="Describe this nonsense.">
<meta name="keywords" content="Jekyll, theme, themes, responsive, blog, modern">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="If not now,when ?">
<meta property="og:description" content="Describe this nonsense.">
<meta property="og:url" content="http://localhost:4000/">
<meta property="og:site_name" content="Hello world, Let's Coding!">





<link rel="canonical" href="http://localhost:4000/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Hello world, Let's Coding! Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">


<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://localhost:4000/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://localhost:4000/images/guoguo.jpg" alt="Helloworldcoding photo" class="author-photo">
					<h4>Helloworldcoding</h4>
					<p>Do what you love to do,and make some change!</p>
				</li>
				<li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:runningele@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				
				
				
				
				<li>
					<a href="https://github.com/helloworldcoding"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://localhost:4000/posts/">All Posts</a></li>
				<li><a href="http://localhost:4000/tags/">All Tags</a></li>
			</ul>
		</li>
		
	    
	    <li><a href="http://localhost:4000/theme-setup/" >Theme Setup</a></li>
	  
	    
	    <li><a href="http://mademistakes.com" target="_blank">External Link</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img src="http://localhost:4000/images/abstract-1.jpg" alt="If not now,when ?">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Hello world, Let's Coding!</h1>
      <h2>If not now,when ?</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-04-26T00:00:00+08:00"><a href="http://localhost:4000/new-job/">April 26, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About Helloworldcoding">Helloworldcoding</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/new-job/" rel="bookmark" title="New Job" itemprop="url">New Job</a></h1>
    
  </header>
  <div class="entry-content">
    <h1 id="新人报到">新人报到</h1>

<h3 id="个人简介">个人简介</h3>

<ul>
  <li>业余爱好： 遛娃，跑步，羽毛球，游泳</li>
  <li>身份标签： 奶爸，IT从业者，毕业大学生，退役军人</li>
  <li>座右铭：学无止境</li>
</ul>

<h3 id="vim之抛砖引玉">Vim之抛砖引玉</h3>

<p><strong>两句玩笑</strong></p>

<blockquote>
  <p>世界上有三种编辑器:Vim,Emacs和其他。
Vim是编辑器之神，Emacs是神之编辑器。</p>
</blockquote>

<p><strong>一个重点</strong></p>
<blockquote>
  <p>不要使用方向键,不要使用方向键，不要使用方向键</p>
</blockquote>

<h4 id="vim使用场景">vim使用场景</h4>

<ol>
  <li>ssh登陆服务器,查看文件</li>
  <li>coding?</li>
  <li>数据处理</li>
</ol>

<p>常用的三种模式： normal // insert // visual
模式间的切换</p>

<p>移动光标(hjkl) <br />
w	往后移动一个单词
b	往前移动一个单词
gg	到第一行
G	到最后一行
gj/gk	屏幕行的移动
ctrl+u	光标向上移动半个屏幕
ctrl+d	光标向下移动半个屏幕
I	光标移动到行首，并进入插入模式
A	光标移动到行尾，并进入插入模式
^(shift+6)	移动到行首非空字符处
0	光标移动到行首	
$	光标移动到行尾
:num	跳转到指定行，比如:12 就是跳转到12行</p>

<p>屏幕滚动 <br />
zz	把光标所在行设置在屏幕中间
zt	把光标所在行定位到屏幕顶部
zb	把光标所在行定位到屏幕底部</p>

<p>括号匹配 <br />
	把光标放在括号上，然后按下%,就跳到闭合的括号上</p>

<p>输入补全</p>
<ol>
  <li>补全单词 ctrl+x  ctrl+n/ctrl+p</li>
  <li>补全路径 ctrl+x  ctrl+f</li>
</ol>

<p>查找字符</p>
<ol>
  <li>单行查找 <br />
 f 字符   向后查找某字符，<code class="highlighter-rouge">;</code>可以重复该查找
 F 字符   向前查找某字符，<code class="highlighter-rouge">;</code>可以重复该查找</li>
  <li>全文查找
 /search_string	从光标所在位置，往下查找，N/n跳转
 ?search_string	从光标所在位置，往上查找，N/n跳转
 *查找	把光标移动到某个单词上，然后按下*,就可以查到所有的单词	
 :noh	关闭高亮</li>
</ol>

<p>位置标记(即使关闭了文件，再打开，位置信息也存在)</p>

<p>``	当前文件上次跳转的地方
`.		上次修改的地方; 比比如第二天，你再打开文件。
`^		上次插入的地方; 比如开了个会或者和同事沟通了一些事情之后</p>

<p>编辑后，发现需要root权限<br />
	:w ! sudo tee %</p>

<p>做计算<br />
	insert模式，ctrl+r =3600<em>24</em>7</p>

<p>查看字符ascii码,16进制，8进制 <br />
	normal模式，ga 查看光标下的字符的ascii码</p>

<p>一些配置</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set nocompatible
set nu
set relativenumber
syntax on
set tabstop=4
set shiftwidth=4 "自动对齐空格数
set softtabstop=4 "退格键一次可以删除4个空格
set autoindent
filetype indent on

iabbrev adn and
iabbrev ture true

" 去掉高亮
nnoremap ,, :noh&lt;cr&gt;
</code></pre></div></div>

<p><strong>一个问题</strong> <br />
vim会上瘾……</p>

<p><strong>一些图片</strong></p>

<figure>
	<a href=""><img src="/images/guoguo.jpg" alt="" /></a>
	<a href=""><img src="/images/new_solider.jpg" alt="" /></a>
	<a href=""><img src="/images/tank.jpg" alt="" /></a>
	<a href=""><img src="/images/cover.jpg" alt="" /></a>
</figure>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-03-31T00:00:00+08:00"><a href="http://localhost:4000/vim-tmux-hotkeys/">March 31, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About Helloworldcoding">Helloworldcoding</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/vim-tmux-hotkeys/" rel="bookmark" title="vim and tmux" itemprop="url">vim and tmux</a></h1>
    
  </header>
  <div class="entry-content">
    <h1 id="learn-some-skills">Learn some skills</h1>

<h3 id="open-two-or--more-files-with-vim">open two or  more files with vim</h3>

<p>vim 1.py 2.py -O</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-O split the window left/right
-o split the window up/down
</code></pre></div></div>

<p>:windo difft</p>

<p>// check the difference between the two files, just like <code class="highlighter-rouge">git diff</code></p>

<h3 id="edit-the-last-modified-file">edit the last modified file</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim $(ls -t | head -1)

or you can set an alias,update your ~/.bashrc
`alias vim1='vim $(ls -t | head -1)'`
</code></pre></div></div>

<h3 id="jumplist--changelist">Jumplist &amp; Changelist</h3>

<p>change jump through buffers</p>

<p><code class="highlighter-rouge">Ctrl+o</code>/<code class="highlighter-rouge">Ctrl+i</code>  cycel through: jumps<br />
<code class="highlighter-rouge">g;</code>/<code class="highlighter-rouge">g,</code>  cycel through:changes</p>

<p><code class="highlighter-rouge">gf</code> goto the file when the cursor is on the filepath</p>

<h3 id="window-routing">window routing</h3>

<p>:vert sf file 
:sf {FIILE} // spilt window and :find {FILE}
<code class="highlighter-rouge">ctrl+x</code> routing the window</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-03-29T00:00:00+08:00"><a href="http://localhost:4000/summary/">March 29, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About Helloworldcoding">Helloworldcoding</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/summary/" rel="bookmark" title="Job summary" itemprop="url">Job summary</a></h1>
    
  </header>
  <div class="entry-content">
    <div class="mermaid">
	graph LR
		ykupgrader[ykupgrader]
		stage(步骤管理)
		flow(流程管理)
		upgrade(更新管理)
		gray(灰度管理)
		private(私有化管理)
		role(角色管理)
		ykupgrader --&gt; stage
		ykupgrader --&gt; flow
		ykupgrader --&gt; upgrade
		ykupgrader --&gt; gray
		ykupgrader --&gt; private
		ykupgrader --&gt; role

		stage --&gt; stage_note[如何定义步骤]
		flow  --&gt; flow_note[如何创建流程]
</div>

<h3 id="步骤stage">步骤stage</h3>

<p><strong>1. 步骤名称规范(用下划线分割单词)</strong></p>

<ul>
  <li>脚本步骤: 环境_script_git仓库(因为租户漂移时要判断,stage_name ‘like 环境_script_%’)</li>
  <li>sql步骤: 环境_数据库_sql  // 要以_sql结尾</li>
  <li>crontab步骤: 环境_crontab</li>
  <li>config步骤: 环境_config</li>
  <li>jenkins步骤: 环境_私有化租户_jenkins //要以_jenkins结尾</li>
</ul>

<p><strong>2. 步骤定义</strong></p>

<ul>
  <li>脚本步骤:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div>    </div>
  </li>
</ul>

<h3 id="流程flow">流程flow</h3>

<ol>
  <li>
    <p>流程名称</p>
  </li>
  <li>
    <p>创建流程</p>

    <ul>
      <li>灰度流程f分支</li>
      <li>f2/bg2分支流程</li>
      <li>其他流程</li>
    </ul>
  </li>
</ol>

<h3 id="更新upgrade">更新upgrade</h3>

<ol>
  <li>
    <p>更新类型</p>
  </li>
  <li>
    <p>创建更新</p>
  </li>
  <li>
    <p>审核更新</p>
  </li>
  <li>
    <p>执行更新</p>
  </li>
  <li>
    <p>其他说明</p>
  </li>
</ol>

<h3 id="灰度漂移">灰度漂移</h3>

<h3 id="私有化更新">私有化更新</h3>

<h3 id="用户和权限管理">用户和权限管理</h3>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-03-25T00:00:00+08:00"><a href="http://localhost:4000/rabbitmq-basic/">March 25, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About Helloworldcoding">Helloworldcoding</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/rabbitmq-basic/" rel="bookmark" title="Note of Rabbitmq basic" itemprop="url">Note of Rabbitmq basic</a></h1>
    
  </header>
  <div class="entry-content">
    <h1 id="rabbitmq-兔子消息队列">Rabbitmq 兔子消息队列</h1>

<h3 id="查看队列长度">查看队列长度</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rabbitmqctl  list_queues | grep _some_keyword | awk -F' ' '{print $2}' // 默认是/这个vhosts
rabbitmqctl -p ykupgrader_vhost list_queues | grep _some_keyword | awk -F' ' '{print $2}' // -p 指定vhost
</code></pre></div></div>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-03-17T00:00:00+08:00"><a href="http://localhost:4000/thread-basic/">March 17, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About Helloworldcoding">Helloworldcoding</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/thread-basic/" rel="bookmark" title="Thread basic" itemprop="url">Thread basic</a></h1>
    
  </header>
  <div class="entry-content">
    <h1 id="thread--process">thread &amp; process</h1>

<blockquote>
  <ol>
    <li>线程(thread)和进程(process)的关系，一个进程可以创建多个线程，或多个进程。</li>
    <li>thread共父进程的内存空间,而子进程则完全复制父进程。</li>
    <li>线程对父进程的变量的修改会相互影响，而子进程不会</li>
  </ol>
</blockquote>

<h3 id="创建一个线程">创建一个线程</h3>

<p>thread1.c</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;  // 多线程，需要引入该头文件
</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">test</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">char</span><span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">args</span><span class="p">;</span> <span class="c1">// void* 强制转化为字符串</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"hello %s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">pthread_t</span> <span class="n">td</span><span class="p">;</span> <span class="c1">// 申明一个线程变量</span>
	<span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">td</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span><span class="s">"zhangsan"</span><span class="p">);</span> <span class="c1">// 创建一个线程，该线程会执行test这个方法，并传入参数zhangsan</span>
	<span class="n">pthread_join</span><span class="p">(</span><span class="n">td</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span> <span class="c1">// 主进程等待线程执行完毕</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>编译代码</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc thread1.c -lpthread -o thread1
./thread1   
</code></pre></div></div>

<h3 id="多线程demo">多线程demo</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;
</span>
<span class="cp">#define NUM 10
</span><span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="n">NUM</span><span class="p">];</span>

<span class="c1">// 定义个类型myargs 这个类型和int float一样，</span>
<span class="c1">// 只不过一个变量定义为int，就只能赋值为整型</span>
<span class="c1">// 而某个变量定义为myargs，则需要赋值为一个结构体</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">start</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">end</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span><span class="n">myargs</span> <span class="p">;</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">test</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">char</span><span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">args</span><span class="p">;</span> <span class="c1">// void* 强制转化为字符串</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"hello %s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">myargs</span><span class="o">*</span> <span class="n">my_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">myargs</span><span class="o">*</span><span class="p">)</span> <span class="n">args</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="n">my_args</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="n">my_args</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">start</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">end</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">my_args</span><span class="o">-&gt;</span><span class="n">sum</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">init_arr</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">arr</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">//arr[i] = rand()%100;</span>
		<span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// 计算一个大数组的和</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">init_arr</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>
	<span class="n">pthread_t</span> <span class="n">td1</span><span class="p">,</span><span class="n">td2</span><span class="p">;</span>

	<span class="n">myargs</span> <span class="n">arg1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="n">NUM</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
	<span class="n">myargs</span> <span class="n">arg2</span> <span class="o">=</span> <span class="p">{</span><span class="n">NUM</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">NUM</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>

	<span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">td1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="o">&amp;</span><span class="n">arg1</span><span class="p">);</span>
	<span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">td2</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="o">&amp;</span><span class="n">arg2</span><span class="p">);</span>
	
	<span class="n">pthread_join</span><span class="p">(</span><span class="n">td1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pthread_join</span><span class="p">(</span><span class="n">td2</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"sum = %d + %d = %d"</span><span class="p">,</span><span class="n">arg1</span><span class="p">.</span><span class="n">sum</span><span class="p">,</span><span class="n">arg2</span><span class="p">.</span><span class="n">sum</span><span class="p">,</span><span class="n">arg1</span><span class="p">.</span><span class="n">sum</span><span class="o">+</span><span class="n">arg2</span><span class="p">.</span><span class="n">sum</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="mutex锁的使用">mutex锁的使用</h3>

<p>多个线程之间可能会对同一内存空间进行修改，这样就会出现race condition.<br />
pthread_mutex_lock方法可以对代码快进行加锁</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;
</span>
<span class="cp">#define NUM  100000
</span>
<span class="n">pthread_mutex_t</span> <span class="n">lock</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">add</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span> <span class="c1">// 如果不加锁，结果很难预测</span>
		<span class="n">s</span><span class="o">++</span><span class="p">;</span>
		<span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span> <span class="c1">// 释放锁</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">pthread_t</span> <span class="n">th</span><span class="p">,</span><span class="n">th1</span><span class="p">;</span>
	<span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">th</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">add</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">th1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">add</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pthread_join</span><span class="p">(</span><span class="n">th</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pthread_join</span><span class="p">(</span><span class="n">th1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"s=%d"</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="false-shareing">false shareing</h3>

<p>当多个线程对内存中存储位置很接近的变量进行修改时，容易导致false sharing<br />
比如thread1修改arr[0]d的值，thread2修改arr[1]的值。</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    

    
    
      <li><strong class="current-page">1</strong></li>
    

    
    

    
    
    

    
      
        
        
        
        <li><a href="http://localhost:4000/page2/">2</a></li>
      
    
      
        
        
        
        <li><a href="http://localhost:4000/page3/">3</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="http://localhost:4000/page7/">7</a></li>
    

    
    
      <li><a href="http://localhost:4000/page2/" class="btn">Next</a></li>
    
  </ul>
</div>


</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2019 Helloworldcoding. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>











<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132764148-1"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-132764148-1');
</script>



          

</body>
</html>